<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Time · Director v3 — Minimal</title>
<meta name="theme-color" content="#0b0d11"/>
<style>
:root{--bg:#0b0d11;--ink:#f5f7ff;--muted:#b8c4d6;--accent:#ffd76b;--glass:rgba(255,255,255,.06);--glass2:rgba(255,255,255,.12);--radius:16px}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0c0f16,#0b0d11);color:var(--ink);-webkit-font-smoothing:antialiased;line-height:1.5}
.container{max-width:1100px;margin:0 auto;padding:20px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
.badge{padding:6px 10px;border-radius:999px;background:var(--glass);border:1px solid var(--glass2);color:var(--muted)}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.btn{background:var(--glass);border:1px solid var(--glass2);border-radius:10px;padding:10px 12px;color:var(--ink);cursor:pointer;font-size:14px}
.btn:disabled{opacity:.6;cursor:not-allowed}
.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
@media (max-width:960px){.grid{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.04));border:1px solid var(--glass2);border-radius:var(--radius);padding:14px}
.card h2{font-size:18px;margin:0 0 8px}
hr{border:0;border-top:1px solid var(--glass2);margin:10px 0}
.code{background:#0b0f15;border:1px solid var(--glass2);border-radius:12px;padding:12px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:14px;color:#e9f2ff;white-space:pre-wrap}
.table{width:100%;border-collapse:separate;border-spacing:0}
.table th,.table td{padding:8px 6px;border-bottom:1px solid var(--glass2);font-size:14px;text-align:left}
.tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.tag{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--glass2);background:var(--glass)}
.ok{background:rgba(56,201,132,.18);border-color:rgba(56,201,132,.38)}
.warn{background:rgba(248,148,37,.18);border-color:rgba(248,148,37,.38)}
.fail{background:rgba(248,82,82,.18);border-color:rgba(248,82,82,.38)}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="badge">single‑file · minimal</div>
  <div class="marina-banner" id="marinaBanner" style="display:none;margin-top:6px;padding:6px 10px;border-radius:10px;background:rgba(255,215,107,.15);border:1px solid rgba(255,215,107,.4);font-weight:600">Marina Mode · Princess of Power (Deluxe)</div>
  <div class="controls">
      <button class="btn" id="run">Run Self‑Check</button>
      <button class="btn" id="export">Export Integrity Stamp</button>
      <button class="btn" id="copyJson">Copy JSON</button>
      <button class="btn" id="downloadCsv">Download CSV</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Abstract</h2>
      <p>Time, energy, distance, matter, frequency, and consciousness are treated as harmonics of a single field. We test a practical bridge: <b>τ = E / c³</b>.</p>
      <hr/>
      <h2>Core Equations</h2>
      <div class="code">E = m c²\nτ = E / c³\nλ = h / p</div>
      <hr/>
      <h2>Dimensions · Units</h2>
      <table class="table" style="margin-bottom:10px">
        <thead><tr><th>Quantity</th><th>Symbol</th><th>SI Unit</th><th>Dimension</th></tr></thead>
        <tbody>
          <tr><td>speed of light</td><td>c</td><td>m·s⁻¹</td><td>L T⁻¹</td></tr>
          <tr><td>Planck constant</td><td>h</td><td>J·s</td><td>M L² T⁻¹</td></tr>
          <tr><td>energy</td><td>E</td><td>J</td><td>M L² T⁻²</td></tr>
          <tr><td>mass</td><td>m</td><td>kg</td><td>M</td></tr>
          <tr><td>wavelength</td><td>λ</td><td>m</td><td>L</td></tr>
          <tr><td>bridge term</td><td>τ = E / c³</td><td>kg·s·m⁻¹</td><td>M L⁻¹ T</td></tr>
        </tbody>
      </table>
      <div class="code" style="margin-bottom:12px">Dimensional checks:
E = m c² → [M][L T⁻¹]² = M L² T⁻²
τ = E / c³ → [M L² T⁻²] / [L³ T⁻³] = M L⁻¹ T</div>

      <h2>Dimensions · Units</h2>
      <table class="table" style="margin-bottom:10px">
        <thead><tr><th>Quantity</th><th>Symbol</th><th>SI Unit</th><th>Dimension</th></tr></thead>
        <tbody>
          <tr><td>speed of light</td><td>c</td><td>m·s⁻¹</td><td>L T⁻¹</td></tr>
          <tr><td>Planck constant</td><td>h</td><td>J·s</td><td>M L² T⁻¹</td></tr>
          <tr><td>energy</td><td>E</td><td>J</td><td>M L² T⁻²</td></tr>
          <tr><td>mass</td><td>m</td><td>kg</td><td>M</td></tr>
          <tr><td>wavelength</td><td>λ</td><td>m</td><td>L</td></tr>
          <tr><td>bridge term</td><td>τ = E / c³</td><td>kg·s·m⁻¹</td><td>M L⁻¹ T</td></tr>
        </tbody>
      </table>
      <div class="code" style="margin-bottom:12px">Dimensional checks:
E = m c² → [M][L T⁻¹]² = M L² T⁻²
τ = E / c³ → [M L² T⁻²] / [L³ T⁻³] = M L⁻¹ T</div>
      
      $1</h2>
      <div class="code" id="schemaBox"></div>
      <h3 style="margin:10px 0 6px">Visual Table</h3>
      <table class="table" id="schemaTable">
        <thead><tr><th>Section</th><th>Field</th><th>Value</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Director Panel · Self‑Check</h2>
      <div class="tags" id="badges"></div>
      <hr/>
      <h3>Live Readouts</h3>
      <table class="table" id="readout">
        <thead><tr><th>Test</th><th>Metric</th><th>Value</th><th>Target</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="code" id="poem" style="margin-top:8px">…</div>
    </div>
  </div>
</div>

<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function badge(text, cls){ var d=document.createElement('div'); d.className='tag '+cls; d.textContent=text; return d; }
  function addRow(tb, a,b,c,d){ var tr=document.createElement('tr'); [a,b,c,d].forEach(function(v){ var td=document.createElement('td'); td.textContent=v; tr.appendChild(td); }); tb.appendChild(tr); }
  function setPoem(s){ var p=$('poem'); if(p) p.textContent=s; }

  // Data schema
  var schema={
    participant_id:"anon-uuid",
    session_id:"uuid",
    device:{model:"string",os:"string",browser:"string",audio:"headphones-model"},
    block:{frequency_hz:432,binaural_delta_hz:4,duration_s:120,spl_dbA:55},
    timing:{start_unix_ms:1730000000000,end_unix_ms:1730000120000,latency_ms:12.4,drift_ms:18.2},
    measures:{time_estimate_s:97.2,delta_tau_s:-22.8,sam_valence:6,sam_arousal:3,pupil_mean_z:0.41,hrv_rmssd:38.2,eeg:{alpha_db:1.8,plv_alpha:0.21},color:{hue_deg:45,sat:0.72,val:0.85}},
    notes:"free text",track:"physics|neuro|psych|poetics|hci",version:"time-paper-v3-min"
  };
  $('schemaBox').textContent = JSON.stringify(schema,null,2);
  var tbody=$('schemaTable').querySelector('tbody');
  function add(sec, field, val){ var v=(typeof val==='object')?JSON.stringify(val):String(val); addRow(tbody, sec, field, v, ''); }
  add('ids','participant_id',schema.participant_id); add('ids','session_id',schema.session_id);
  Object.keys(schema.device).forEach(function(k){ add('device',k,schema.device[k]); });
  Object.keys(schema.block).forEach(function(k){ add('block',k,schema.block[k]); });
  Object.keys(schema.timing).forEach(function(k){ add('timing',k,schema.timing[k]); });
  Object.keys(schema.measures).forEach(function(k){ add('measures',k,schema.measures[k]); });
  add('meta','track',schema.track); add('meta','version',schema.version);

  // Self-check
  var badges=$('badges'); var tb=$('readout').querySelector('tbody');
  function clear(){ badges.innerHTML=''; tb.innerHTML=''; }

  function addBadge(name, ok){ badges.appendChild(badge(name+' '+(ok?'ok':'check'), ok?'ok':'warn')); }

  function testTimerDrift(ms){ return new Promise(function(resolve){ var t0=performance.now(); setTimeout(function(){ var d=(performance.now()-t0)-ms; resolve({ok:Math.abs(d)<30, drift_ms:+d.toFixed(2)}); }, ms); }); }
  function testRender(ms){ return new Promise(function(resolve){ var frames=0; var s=performance.now(); function tick(){ frames++; if(performance.now()-s<ms){ requestAnimationFrame(tick); } else { var el=performance.now()-s; var exp=el/16.6667; var loss=Math.max(0,exp-frames); resolve({ok:loss<2, frames:Math.round(frames), loss:+loss.toFixed(1)}); } } requestAnimationFrame(tick); }); }
  async function testAudio(hz){ try{ var AC=window.AudioContext||window.webkitAudioContext; if(!AC) return {ok:false, reason:'unsupported'}; var ctx=new AC(); if(ctx.state==='suspended'){ try{ await ctx.resume(); }catch(_){} }
    var osc=ctx.createOscillator(); var g=ctx.createGain(); var an=ctx.createAnalyser(); an.fftSize=2048; g.gain.value=0.1; osc.type='sine'; osc.frequency.setValueAtTime(hz, ctx.currentTime); osc.connect(g); g.connect(an); an.connect(ctx.destination); osc.start(); await new Promise(function(r){ setTimeout(r,200); }); var buf=new Float32Array(an.fftSize); an.getFloatTimeDomainData(buf);
    function auto(a,sr){ var size=a.length, m=Math.floor(size/2), best=0, lag=-1, rms=0; for(var i=0;i<size;i++){ var v=a[i]; rms+=v*v; } rms=Math.sqrt(rms/size); if(rms<0.008) return null; var last=0; for(var L=1;L<m;L++){ var sum=0; for(var j=0;j<m;j++){ sum+=a[j]*a[j+L]; } if(sum>best && sum>last){ best=sum; lag=L; } last=sum; } return lag>0? sr/lag : null; }
    var est=auto(buf, ctx.sampleRate); try{ osc.stop(); }catch(_){ } try{ osc.disconnect(); g.disconnect(); an.disconnect(); }catch(_){ } try{ await ctx.close(); }catch(_){ }
    if(!est) return {ok:false, reason:'no-signal'}; var err=Math.abs(est-hz); return {ok:err<=0.5, est:+est.toFixed(2), err:+err.toFixed(2)};
  }catch(e){ return {ok:false, reason:'error'} }
  }

  $('run').addEventListener('click', async function(){ clear(); setPoem('measuring…');
    var a=await testAudio(128); addBadge('audio@128', a.ok); addRow(tb,'Audio','Hz error (128)', a.err!=null?(a.err+' Hz'):'—','≤ 0.5 Hz');
    var t=await testTimerDrift(1000); addBadge('timer', t.ok); addRow(tb,'Timer','Drift', t.drift_ms+' ms','< 30 ms');
    var r=await testRender(1800); addBadge('render', r.ok); addRow(tb,'Render','Frames / Loss', r.frames+' / '+r.loss,'loss < 2');
    var ok = (!!a.ok) && (!!t.ok) && (!!r.ok); setPoem(ok?'coherence holds — phase within tolerance; light remains aligned.':'we found a ripple; breathe once, then measure again.');
  });

  $('export').addEventListener('click', async function(){ var stamp={version:'time-v3-min', ts:new Date().toISOString(), results:{}}; var a=await testAudio(128); stamp.results.audio=a; var t=await testTimerDrift(1000); stamp.results.timer=t; var r=await testRender(1000); stamp.results.render=r; var blob=new Blob([JSON.stringify(stamp,null,2)],{type:'application/json'}); var url=URL.createObjectURL(blob); var aTag=document.createElement('a'); aTag.href=url; aTag.download='integrity-stamp.json'; document.body.appendChild(aTag); aTag.click(); setTimeout(function(){ URL.revokeObjectURL(url); aTag.remove(); },0); });

  $('copyJson').addEventListener('click', function(){ try{ navigator.clipboard.writeText($('schemaBox').textContent); setPoem('JSON copied'); setTimeout(function(){ setPoem('…'); },1200); }catch(_){ var t=document.createElement('textarea'); t.value=$('schemaBox').textContent; document.body.appendChild(t); t.select(); document.execCommand('copy'); t.remove(); setPoem('JSON copied'); setTimeout(function(){ setPoem('…'); },1200); } });
  $('downloadCsv').addEventListener('click', function(){ var rows=[["section","field","value"]]; Array.from(tbody.querySelectorAll('tr')).forEach(function(tr){ var tds=tr.querySelectorAll('td'); rows.push([tds[0].textContent,tds[1].textContent,tds[2].textContent]); }); var csv=rows.map(function(r){ return r.map(function(x){ return '"'+String(x).replace(/"/g,'""')+'"'; }).join(','); }).join('\n'); var blob=new Blob([csv],{type:'text/csv'}); var url=URL.createObjectURL(blob); var aTag=document.createElement('a'); aTag.href=url; aTag.download='schema_table.csv'; document.body.appendChild(aTag); aTag.click(); setTimeout(function(){ URL.revokeObjectURL(url); aTag.remove(); },0); });
})();
// Marina Mode toggle
  (function(){
    function flash(msg){ var p=document.getElementById('poem'); if(p){ p.textContent=msg; setTimeout(()=>p.textContent='…',1200); } }
    var banner=document.getElementById('marinaBanner');
    var header=document.querySelector('.controls');
    if(header){ var btn=document.createElement('button'); btn.textContent='Marina Mode'; btn.className='btn'; header.appendChild(btn);
      btn.addEventListener('click',function(){ document.body.classList.toggle('marina'); var on=document.body.classList.contains('marina'); if(banner) banner.style.display=on?'block':'none'; flash(on?'Marina Mode on':'Marina Mode off'); });
    }
    // style injection
    var s=document.createElement('style'); s.textContent='body.marina{background:radial-gradient(1200px 800px at 15% -10%,#1d0f18 0%,#0a0c10 55%),#0a0c10;color:#fff8fb;}'; document.head.appendChild(s);
    // auto-enable via URL param
    if(/[?#].*marina/i.test(window.location.href)){ document.body.classList.add('marina'); if(banner) banner.style.display='block'; flash('Marina Mode auto'); }
  })();
</script>
</body>
</html>
